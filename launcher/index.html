<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `launcher` crate."><meta name="keywords" content="rust, rustlang, rust-lang, launcher"><title>launcher - Rust</title><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../dark.css"><link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle"><script src="../storage.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="shortcut icon" href="https://openstratos.org/wp-content/uploads/2015/10/OpenStratos-mark.png"><style type="text/css">#crate-search{background-image:url("../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu">&#9776;</div><a href='../launcher/index.html'><img src='https://openstratos.org/wp-content/uploads/2017/05/OpenStratos-768x226.png' alt='logo' width='100'></a><p class='location'>Crate launcher</p><div class="sidebar-elems"><a id='all-types' href='all.html'><p>See all launcher's items</p></a><div class="block items"><ul><li><a href="#functions">Functions</a></li></ul></div><p class='location'></p><script>window.sidebarCurrent = {name: 'launcher', ty: 'mod', relpath: '../'};</script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!"><img src="../brush.svg" width="18" alt="Pick another theme!"></button><div id="theme-choices"></div></div><script src="../theme.js"></script><nav class="sub"><form class="search-form js-only"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><a id="settings-menu" href="../settings.html"><img src="../wheel.svg" width="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class='fqn'><span class='out-of-band'><span id='render-detail'><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class='inner'>&#x2212;</span>]</a></span><a class='srclink' href='../src/launcher/main.rs.html#1-194' title='goto source code'>[src]</a></span><span class='in-band'>Crate <a class="mod" href=''>launcher</a></span></h1><div class='docblock'><p>Balloon software launcher.</p>
<p>This crate contains the main initialization logic for the balloon software. For further
development documentation, please refer to the <a href="../os_balloon/index.html"><code>os_balloon</code></a> crate.
OpenStratos is designed to work in a Raspberry Pi model A+, B+, Zero, v2 B or v3 B, but it could
work in other Linux-powered devices too with proper configuration.</p>
<h2 id="running-openstratos" class="section-header"><a href="#running-openstratos">Running OpenStratos</a></h2>
<p>Running OpenStratos is as simple as installing the latest Rust stable build (preferably using
<a href="https://rustup.rs/">rustup.rs</a>) and then running <code>cargo run</code> in the crate directory. Remember
to use <code>cargo run --release</code> to compile the software with all optimizations enabled.</p>
<h2 id="features" class="section-header"><a href="#features">Features</a></h2>
<p>It is possible that the setup you want for OpenStratos is different from the default one.
Luckily, OpenStratos supports
<a href="http://doc.crates.io/manifest.html#the-features-section">Cargo features</a> and can be configured
and extended easily.</p>
<p>Current features are:</p>
<ul>
<li><strong>GPS</strong> (<code>--features=&quot;gps&quot;</code>): Enables GPS monitoring. You will need to provide a serial port
and a disable/enable GPIO pin if you want OpenStratos to control the GPS on/off behaviour. The
tested and recommended GPS module is the
<a href="https://store.uputronics.com/index.php?route=product/product&amp;product_id=84">uBLOX MAX-M8Q</a>
model. If you wish to use a separate GPS device, or directly not use GPS, you can opt-out to
this feature. <strong>Important</strong>: OpenStratos won't have information about location above 1.2km
altitude (below that point only if GSM is active). This means that it will not be able to send
SMS / telemetry about position and that pictures won't have EXIF information about localization.</li>
<li><strong>Raspberry Pi camera</strong> (<code>--features=&quot;raspicam&quot;</code>): Enables the Raspberry Pi camera module.
OpenStratos is prepared to work with the Raspberry Pi V2 camera module, but it will work with
the V1 version too (you will have to make sure you provide a proper configuration for picture
size, as you won't have 8MP available and OpenStratos checks configuration against those 8MP).
The software will take pictures at the configured intervals, and add EXIF GPS information if
available. It will also record video with the specified configuration. You can opt-out to this
feature and use your own external camera, or remove imaging directly. You could also use other
kind of camera if using a device different than the Raspberry Pi. If you wish to use a different
camera and control it using OpenStratos, you should extend the software adding a driver for that
device.</li>
<li><strong>Adafruit FONA</strong> (<code>--features=&quot;fona&quot;</code>): Enables Adafruit's FONA GSM module. OpenStratos is
prepared to work with Adafruit's FONA GSM module. It will send SMSs in different stages of the
flight (check below for more information about SMSs). It will also use GSM localization if no
GPS is found, or if the GPS fails (safe mode operation). Furthermore, if configured properly,
it will check battery levels of both FONA's battery and the main battery using FONA's on-chip
ADC (analog-digital-converter). You can opt-out to this feature, and information will be sent
using telemetry module. Nevertheless, it's a good idea to have GSM in case live telemetry fails
or a LOS (loss of signal) happens.</li>
<li><strong>Live transparent serial telemetry</strong> (<code>--features=&quot;telemetry&quot;</code>): Enables real time telemetry.
OpenStratos is capable to send telemetry via a serial device. This can be used with an XBee
module in transparent mode, for example, to receive the information via serial in the client
(in a laptop computer in the ground, for example).</li>
<li><em>TODO: commands?</em></li>
</ul>
<p>All these features are enabled by default. You can opt-out to all of them passing the
<code>--no-default-features</code> flag to Cargo when building / running the software, and enable each of
them separately. To enable more than one feature, add space between them in the <code>--features</code>
option. E.g. <code>--no-default-features --features=&quot;gps telemetry&quot;</code>.</p>
<h2 id="configuration" class="section-header"><a href="#configuration">Configuration</a></h2>
<p>OpenStratos is highly configurable. Please refer to the
<a href="../os_balloon/config/index.html"><code>config</code></a> module for further information.</p>
<h2 id="main-logic" class="section-header"><a href="#main-logic">Main logic</a></h2>
<p>OpenStratos logic is divided in states, implemented as a type-level state machine. For
implementation details, please refer to the <a href="../os_balloon/logic/index.html"><code>logic</code></a> module.</p>
<p>When first powered up, if no state file exists (the software has never run before), the on-board
computer will start in initialization mode. Here,it will check for enough available disk space,
if the camera is working properly (in case the corresponding feature is enabled), will
initialize / reboot GPS and GSM (if they are enabled) and check if the probe has enough battery
for the flight (in case the ADC in the Adafruit FONA is configured for that). Once all tests
pass, it will start the picture and battery threads, that will take pictures once in a while and
log the battery usage respectively. Picture thread will only be started in the case that camera
feature is enabled, and battery thread will only log FONA battery if the ADC is not connected to
the main battery. FONA feature is required for this. One of the first steps of the
initialization, even before running the tests will be to start the system thread. This thread
will log information about CPU and RAM usage, along with CPU/GPU temperature.</p>
<p>Once the initialization is complete, and if the GPS is enabled, OpenStratos will wait for a GPS
fix. Once the GPS fix is acquired, it will first wait 10 seconds for the GPS fix to stabilize,
and will then start the camera video recording. Once the camera starts recording properly, it
will send an SMS with information about the initialization:</p>
<pre><code class="language-text">Init: OK.
Alt: 256 m
Lat: 3.2759
Lon: 40.1578
PDOP: 3.24
Sat: 7
Fix: OK
Main bat: 92%
GSM bat: 93%
Waiting launch.
</code></pre>
<p>The information in this SMS is the altitude, the latitude, the longitude, the position dilution
of precision (PDOP), the number of GPS satellites connected, the GPS fix status and the battery
capacities. Of course, this content will vary if no GPS is provided. It will try to send it a
second time if it fails the first one. Once the SMS is sent, OpenStratos assumes that the balloon
could be launched, so it will not stop until landing or critical failure.</p>
<p>The on-board computer will now wait for the launch. It will try to get a reasonable precision
in altitude to record the launch altitude (to check it later). It will then wait until launch.
It will try to detect a rapid ascent, or as a backup, if the current altitude is much higher
than the launch altitude (100m with good precision, more if the precision is bad). This will
only work if GPS is enabled. If not, it will simply record until the device is manually shut
down, OpenStratos will have no way of knowing its state. You will need to provide your own
tracking mechanism.</p>
<p>Once launched, the balloon will wait for balloon burst. It will first send a launch confirmation
SMS so that you can know that the software detected the launch properly, and will then try to
send an SMS before loosing network connection, acknowledging that the launch was OK and that it
will loose GSM connectivity. This happens before getting to 2km altitude. Once this SMS is sent,
the FONA will be shut down and will only be turned on to check the batteries if configured to do
so. Burst detection, once again will be done in two steps. It will first try to detect a fast
decay in altitude, and if it doesn't, burst will be detected after loosing 1km from the maximum
altitude ever reached.</p>
<p>Once the balloon bursts, it will no longer take any pictures. The whole descent will be recorded
in video (if the camera is enabled). Once the balloon gets to 2.5km altitude, it will turn on
the GSM and try to send an SMS. It will try to send SMSs at 2.5km, 1.5km and 500m altitude above
sea level. Some/all of them might fail, if the connectivity is poor or if the probe lands higher
than any of those marks. It's not a problem, since once the landing is detected, a landed SMS
will be sent. Landing is detected if the probe is more or less at the same altitude for a long
time (expected descent rate is bigger than 5 m/s).</p>
<p>Once the landed SMS is sent properly (it will try to send it as many times as the battery lets
it if it fails), it will wait 10 minutes and send another one. This prevents against probe being
in movement (could have landed in a river/truck or any other moving element).</p>
<p>After both SMSs get sent, the probe shuts down cleanly.</p>
<h2 id="safe-mode" class="section-header"><a href="#safe-mode">Safe mode</a></h2>
<p><em>In development…</em></p>
</div><h2 id='functions' class='section-header'><a href="#functions">Functions</a></h2>
<table><tr class='module-item'><td><a class="fn" href="fn.main.html" title='launcher::main fn'>main</a></td><td class='docblock-short'><p>Program entry point.</p>
</td></tr></table></section><section id="search" class="content hidden"></section><section class="footer"></section><aside id="help" class="hidden"><div><h1 class="hidden">Help</h1><div class="shortcuts"><h2>Keyboard Shortcuts</h2><dl><dt><kbd>?</kbd></dt><dd>Show this help dialog</dd><dt><kbd>S</kbd></dt><dd>Focus the search field</dd><dt><kbd>↑</kbd></dt><dd>Move up in search results</dd><dt><kbd>↓</kbd></dt><dd>Move down in search results</dd><dt><kbd>↹</kbd></dt><dd>Switch tab</dd><dt><kbd>&#9166;</kbd></dt><dd>Go to active search result</dd><dt><kbd>+</kbd></dt><dd>Expand all sections</dd><dt><kbd>-</kbd></dt><dd>Collapse all sections</dd></dl></div><div class="infos"><h2>Search Tricks</h2><p>Prefix searches with a type followed by a colon (e.g., <code>fn:</code>) to restrict the search to a given type.</p><p>Accepted types are: <code>fn</code>, <code>mod</code>, <code>struct</code>, <code>enum</code>, <code>trait</code>, <code>type</code>, <code>macro</code>, and <code>const</code>.</p><p>Search functions by type signature (e.g., <code>vec -> usize</code> or <code>* -> vec</code>)</p><p>Search multiple things at once by splitting your query with comma (e.g., <code>str,u8</code> or <code>String,struct:Vec,test</code>)</p></div></div></aside><script>window.rootPath = "../";window.currentCrate = "launcher";</script><script src="../aliases.js"></script><script src="../main.js"></script><script defer src="../search-index.js"></script></body></html>